## Lattice-Planner 用户手册

**文档版本**：V1.0  
**软件名称**：Lattice-Planner 个人规划与任务管理系统  

---

### 1. 概览

**Lattice-Planner** 是一款面向个人的规划与任务管理工具，帮助你在「执行」「学习」「规划」等不同思维模式下，更有条理地安排与回顾自己的工作和生活。软件由**服务端 Web 应用**与**桌面客户端**组成：可通过浏览器访问，也可使用 Windows 桌面客户端，在系统托盘中常驻并接收任务截止提醒。

核心特点包括：

- **多思维模式**：执行 / 学习 / 规划 三种模式，满足不同使用场景。
- **任务管理**：支持任务创建、完成、搁置、删除以及搜索和视图切换。
- **目标与笔记**：任务可以绑定目标，配合笔记记录，实现从计划到复盘的闭环。
- **规划得分曲线**：根据任务、目标、笔记综合计算每日规划得分，以折线图形式展示。
- **AI 总结**：基于一段时间的每日得分，自动生成自然语言总结与建议。
- **桌面端与 DDL 提醒**：桌面客户端支持系统托盘、任务截止日前 1 天/3 天及已过期的桌面通知提醒。

---

### 2. 快速开始

#### 2.1 运行环境与访问方式

- **Web 端**：在浏览器中打开 Lattice-Planner 服务端地址（例如管理员提供的 URL，或本地开发时的 http://localhost:8080）。
- **桌面端**：安装并运行 Lattice-Planner 桌面客户端（Windows）；首次使用前请确保服务端已启动，客户端默认连接 http://localhost:8080，如需连接其他地址可通过环境变量配置。  
  桌面端启动后会打开与 Web 相同的登录与看板界面；关闭主窗口时程序会最小化到系统托盘，可从托盘再次打开或选择退出。

#### 2.2 注册与登录

1. 打开 Lattice-Planner 系统首页（浏览器或桌面客户端内）。
2. 在登录页面：
   - 如果已有账号，直接输入用户名和密码登录。
   - 如果没有账号，可以通过「注册」链接创建新账号（根据部署配置，可能只允许管理员创建）。
3. 登录成功后，你会进入默认的「今日任务看板」或功能选择页。

> 具体菜单名称和入口位置视前端主题略有差异，但整体流程类似。

#### 2.2 选择思维模式

Lattice-Planner 提供三种思维模式：

- **执行模式**：更偏向「赶紧做完」，界面以待办执行为主。
- **学习模式**：更强调学习任务与积累。
- **规划模式**：专注于「如何安排与复盘」，会提供规划得分与 AI 总结功能。

首次使用时，系统会引导你选择一种模式。之后你可以随时通过导航中的模式切换入口（例如「切换模式」按钮或菜单）在三种模式之间切换。

> 注意：部分功能（如规划得分曲线、AI 总结）目前仅在「规划模式」下可见。若使用桌面客户端，登录后才会进行任务截止检查并发送桌面提醒。

---

### 3. 界面与主要模块说明

登录后，你通常会看到一个包含以下区域的界面：

- 顶部或侧边导航栏
  - 任务 / 今日看板
  - 目标
  - 笔记
  - 洞察 / 统计（规划得分曲线与 AI 总结）
  - 偏好设置
  - 模式切换、登出

- 今日任务看板（Dashboard）
  - 展示当前模式下的今日任务清单。
  - 支持不同视图方式，如按时间段、按精力需求等。
- **目标与任务树**（右上角按钮，默认隐藏）
  - 点击「目标与任务树」可显示/隐藏一张**树状结构图**，用节点与连线直观展示「有关联关系」的目标及其下属任务；独立目标或任务不显示。三种思维模式下均可查看。

---

### 4. 任务管理

#### 4.1 创建任务

在导航中选择「任务」或直接在今日任务看板上点击「添加任务 / 新建任务」按钮，进入新任务表单页面。

常见字段说明：

- **标题**（必填）：任务的简要名称，例如「写周报」。
- **描述**：对任务的详细说明。
- **截止日期（Deadline）**：
  - 用于确定这条任务归属哪一天的规划得分。
  - 即使任务完成时间不同，得分统计仍以截止日期为准。
- **精力需求（Energy Level）**：
  - 一般包含「高 / 中 / 低」等选项。
  - 在得分计算中，精力需求越高的任务权重越大。
- **心理负担（Mental Load）**：
  - 如「沉重 / 较轻」等。
  - 心理负担越重的任务，完成后对得分的贡献越大。
- **期望时间段（Preferred Slot）**：
  - 比如「上午 / 下午 / 晚上」。
  - 影响在时间段视图中的展示，不直接影响得分。
- **关联目标**（可选）：
  - 可以选择一个已有目标，或者在目标管理中先创建目标再关联。
  - 与目标关联的任务，会影响目标相关的得分维度。

> 与得分的关系（概览）：
> - 精力需求、心理负担、任务周期（创建日期到截止日期的天数）会共同决定这条任务的「权重」。
> - 在计算每日规划得分时，系统会统计「当天截止的任务中，完成的权重占比」以及「总体完成的任务权重」，用于构建任务维度的得分。

#### 4.2 管理任务

在今日任务看板或任务列表页面，你可以对任务进行以下操作：

- **标记为完成**：
  - 点击「完成 / Done」按钮。
  - 该任务会计入当天所属截止日期的完成任务统计。
- **搁置任务**：
  - 点击「搁置 / Shelve」按钮，将任务暂时从当前视图移出。
  - 搁置不会计为完成，也不会直接增加得分。
- **删除任务**：
  - 点击「删除 / Delete」按钮。
  - 删除为不可逆操作，请谨慎使用。
- **搜索 / 筛选任务**：
  - 通过搜索框根据关键词搜索任务标题与描述。
  - 可通过日期范围筛选任务（起止日期）。
- **视图切换**：
  - 时间段视图：按「上午、下午、晚上」等时间段分组展示任务。
  - 精力视图：按精力需求（高/中/低）分组展示任务，适合在不同精力状态下挑任务执行。

---

### 5. 目标与笔记管理

#### 5.1 目标管理

在导航中选择「目标」进入目标列表页面，可进行以下操作：

- **创建目标**：
  - 为你的中长期计划添加一个清晰的目标，例如「完成某门课程」「整理仓库」。
- **归档目标**：
  - 当某个目标已经达成，可以将其归档，表示阶段性完成。
- **删除目标**：
  - 删除不再需要的目标（请确认不会影响你的统计分析预期）。

任务与目标的关联：

- 在创建或编辑任务时，可以将任务绑定到某个目标。
- 在统计和得分中，与目标有关的两个重要方面：
  - 目标进度：系统会根据相关任务的完成情况，对目标整体进度进行估计。
  - 目标维度得分：某天完成的目标数量、以及当天有推进的目标覆盖面，都会对当日得分产生正向影响。

#### 5.2 笔记管理

在导航中选择「笔记」进入笔记列表页面：

- **添加笔记**：
  - 填写标题和内容记录你的想法、复盘、灵感等。
- **查看笔记**：
  - 在列表中点击某条笔记进行查看。

笔记与得分的关系：

- 系统会根据当天创建的笔记数量给予一定的加分：
  - 笔记越多，说明你记录与反思越充分。
  - 但加分是非线性的：2～4 条左右就能接近满分，避免通过大量碎片笔记刷分。

---

### 6. 偏好设置

在导航中选择「偏好设置 / 用户设置」，可以调整自己的使用偏好。设置页按**思维模式**分组：先选择要配置的模式（执行/学习/规划），再修改该模式下可用的选项。

**通用（与模式无关）**

- **背景亮/暗**：亮色（默认）或暗色界面主题。
- **默认思维模式**：切换模式或首次选择时，选择页将预选此项。

**按模式可配置项（简述）**

- **执行模式**：每屏最多显示任务数。
- **学习模式**：每屏任务数、是否显示未来任务。
- **规划模式**：除上述外，还包括默认任务视图（今日/时间段/精力）、是否显示统计信息、目标管理区块、规划完成得分曲线、模糊任务提示、归档/搁置区块，以及「模糊任务存在超过 N 天提示拆分」的天数（0 表示不提示）。

> 提示：如果你在规划模式下看不到「得分曲线」或「AI 总结」相关入口，请先在偏好设置中选择「规划模式」，勾选「显示统计信息」并保存。

---

### 7. 规划得分与统计视图

#### 7.1 入口与视图

在导航中选择「洞察 / 统计」或类似入口，可以进入规划得分曲线页面。

主要组成部分：

- 日期区间选择器：
  - 可设置起始日期和结束日期。
  - 默认显示最近 14 天的数据（从今天往前推 13 天）。
- 每日得分折线图：
  - 使用图表展示每一天的综合规划得分。
  - 每个点对应当天的总分（0–100）。

#### 7.2 每日得分的构成（0–100 分）

每日得分由三个维度构成：

1. **任务维度（0–70 分）**
   - 计算逻辑考虑：
     - 加权完成率：每个任务权重由精力需求、心理负担、任务周期共同决定。
     - 吞吐量因子：完成任务的权重总量通过一条带有边际递减的函数映射到分值。
   - 设计意图：
     - 鼓励完成重要且难度较高的任务，而不是拆分大量微小任务刷分。
     - 对「做完少量关键任务」给予足够肯定。

2. **目标维度（0–20 分）**
   - 根据：
     - 各目标的整体进度（对进度值做幂变换以强调中高进度）。
     - 当天完成的目标数。
     - 当天有推进的目标覆盖面（有多少不同目标被推进）。
   - 设计意图：
     - 鼓励用户长期围绕几个核心目标持续推进。
     - 防止只堆短期任务而忽略中长期成长。

3. **笔记维度（0–10 分）**
   - 根据当天笔记条数，通过递减增益函数映射到 0–10 分。
   - 设计意图：
     - 鼓励用户写少量高质量复盘笔记。
     - 避免通过重复记录碎片笔记来刷分。

重要说明：

- 归属日期以任务的截止日期（Deadline）为准，而不是任务的完成日期。
- 得分数据是按需实时计算的，并未单独存入数据库，因此每次查看统计时都会从任务、目标、笔记等数据中重新计算。

---

### 8. AI 总结功能

#### 8.1 功能说明

AI 总结会基于你在某一时间段内的每日规划得分，自动生成一段自然语言总结和建议，帮助你：

- 快速了解这段时间整体表现趋势（上升、波动或下滑）。
- 识别在哪些方面做得好（如目标推进、笔记记录）。
- 找到可改进的点（如任务规划、执行节奏等）。

#### 8.2 使用方式

1. 在导航中选择「洞察 / 统计」，进入规划得分曲线页面。
2. 设置你感兴趣的起始日期与结束日期：
   - 默认会展示最近 14 天，也可以调整到一段更长或更短的时间。
3. 点击「AI 总结这一段时间」按钮。
4. 稍等几秒，系统会在页面上展示一段总结文字。

总结内容通常包括：

- 总体得分趋势描述。
- 各维度（任务、目标、笔记）的表现分析。
- 未来一段时间的建议。

#### 8.3 API Key 配置（高级 / 运维用户）

Lattice-Planner 的 AI 总结功能可选地依赖外部的 Google Gemini 模型，当环境中配置了有效的 API Key 时，会调用在线模型生成更丰富的总结；否则退回到内置的本地规则总结。

支持的 API Key 配置方式（按优先级从高到低）：

1. 在应用配置文件中设置：
   - `gemini.api.key=YOUR_API_KEY`
2. 设置环境变量：
   - `GEMINI_API_KEY=YOUR_API_KEY`
3. 备用环境变量：
   - `GOOGLE_API_KEY=YOUR_API_KEY`

未配置 API Key 的情况：

- AI 总结按钮仍然可用。
- 系统会使用本地规则生成摘要，并在文案中提示当前使用的是本地总结。
- 对普通用户而言，仍然可以获得基础的文字总结。

#### 8.4 等待与失败情况

- 调用外部 AI 模型时，通常会在数秒内返回结果。
- 若请求超时（约 8 秒）或调用失败：
  - 系统会自动回退到本地规则总结。
  - 不需要你重复点击或额外操作。

---

### 9. 常见问题与易踩坑

#### 9.1 看不到统计和 AI 总结入口？

可能原因：

- 当前未处于「规划模式」。
- 在「偏好设置」中未开启「显示统计信息（showStatistics）」。

解决方法：

1. 通过导航切换至规划模式。
2. 打开「偏好设置」，勾选「显示统计信息」，保存后返回看板页面。

#### 9.2 AI 总结提示「使用本地总结」？

这通常意味着当前部署环境未配置有效的 Gemini API Key。

- 如果你是普通用户，可以继续使用本地总结，无需额外操作。
- 如果你是运维或开发人员，可以参考「8.3 API Key 配置」一节，设置对应的配置项或环境变量。

#### 9.3 某天任务完成很多，但得分不高？

可能因素包括：

- 完成的大部分是低精力、低心理负担、短周期的小任务，它们的权重本身就较低。
- 当天几乎没有推进重要目标，目标维度得分偏低。
- 当天没有写笔记或笔记数量较少，笔记维度加分不高。

建议：

- 在安排任务时兼顾少量高权重任务（高精力、长期目标相关）。
- 持续推进中长期目标，并定期写简短的复盘笔记。

#### 9.4 AI 总结结果不符合预期？

- 如果使用外部 AI，总结风格和措辞会受到模型影响。
- 如需更准确或更个性化的建议，可以：
  - 拉长统计周期，提供更多数据。
  - 辅以手工复盘，将 AI 总结作为辅助参考。

#### 9.5 桌面客户端无法连接或收不到提醒？

- **无法连接**：请确认 Lattice-Planner 服务端已启动，且客户端连接地址正确（默认 http://localhost:8080）。若服务端部署在其他地址，需配置环境变量 ELECTRON_APP_BASE_URL 后重启客户端。连接失败时，客户端会显示错误页，可点击「重试」重新加载。
- **收不到提醒**：请确认已在客户端内登录（与 Web 共用同一账号）；提醒仅对「未完成且设置了截止日期」的任务生效，且同一任务在同一天内不会重复提醒。若仍无提醒，可检查系统是否允许应用发送通知。

---

### 10. 桌面客户端简要说明

使用 **Lattice-Planner 桌面客户端**时：

- **启动与托盘**：运行客户端后主窗口打开服务端页面；关闭窗口后程序最小化到系统托盘，单击托盘图标可再次打开主窗口，右键托盘图标可选择「打开 Lattice-Planner」或「退出」。
- **单实例**：若已有一个客户端在运行，再次启动只会激活已有窗口，不会多开。
- **DDL 提醒**：登录后，客户端会定期检查你的任务截止日期，对「已过期」「1 天内截止」「3 天内截止」的任务弹出桌面通知；同一任务每天最多提醒一次。
- **退出**：需在托盘右键菜单中选择「退出」才会完全关闭程序。

---

本手册描述的是 Lattice-Planner V1.0 的主要功能与行为，具体界面细节可能随版本演进而略有变化。

